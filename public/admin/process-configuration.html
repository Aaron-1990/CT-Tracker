<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuraci√≥n de Procesos - VSM Admin</title>
    <style>
        /* ===== VARIABLES GLOBALES ===== */
        :root {
            --primary-blue: #3498db;
            --secondary-blue: #2980b9;
            --success-green: #27ae60;
            --warning-orange: #f39c12;
            --danger-red: #e74c3c;
            --background-dark: #2c3e50;
            --background-light: #ecf0f1;
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
            --border-light: #bdc3c7;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
            --shadow-hover: 0 4px 20px rgba(0,0,0,0.15);
            --border-radius: 8px;
            --transition: all 0.3s ease;
        }

        /* ===== RESET Y BASE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* ===== CONTAINER PRINCIPAL ===== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ===== HEADER ===== */
        .header {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            border-left: 5px solid var(--primary-blue);
        }

        .header h1 {
            color: var(--background-dark);
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header p {
            color: var(--text-light);
            font-size: 1.1rem;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .breadcrumb a {
            color: var(--primary-blue);
            text-decoration: none;
            transition: var(--transition);
        }

        .breadcrumb a:hover {
            color: var(--secondary-blue);
            text-decoration: underline;
        }

        /* ===== LAYOUT DE DOS COLUMNAS ===== */
        .main-layout {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
            align-items: start;
        }

        /* ===== SIDEBAR - LISTA DE PROCESOS ===== */
        .processes-sidebar {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            position: sticky;
            top: 20px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--background-light);
        }

        .sidebar-header h3 {
            color: var(--background-dark);
            font-size: 1.3rem;
        }

        .add-process-btn {
            background: var(--success-green);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .add-process-btn:hover {
            background: #229954;
            transform: translateY(-1px);
        }

        /* ===== LISTA DE PROCESOS ===== */
        .process-list {
            list-style: none;
        }

        .process-item {
            background: #f8f9fa;
            margin-bottom: 0.75rem;
            border-radius: var(--border-radius);
            border: 2px solid transparent;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }

        .process-item:hover {
            border-color: var(--primary-blue);
            box-shadow: var(--shadow);
        }

        .process-item.active {
            border-color: var(--primary-blue);
            background: #e3f2fd;
        }

        .process-item-content {
            padding: 1rem;
        }

        .process-name {
            font-weight: bold;
            color: var(--background-dark);
            margin-bottom: 0.25rem;
        }

        .process-meta {
            font-size: 0.8rem;
            color: var(--text-light);
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .process-status {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .status-configured {
            background: #d4edda;
            color: #155724;
        }

        .status-draft {
            background: #fff3cd;
            color: #856404;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
        }

        /* ===== √ÅREA DE CONFIGURACI√ìN PRINCIPAL ===== */
        .configuration-area {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .config-header {
            background: var(--primary-blue);
            color: white;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .config-title {
            font-size: 1.4rem;
            font-weight: bold;
        }

        .config-actions {
            display: flex;
            gap: 0.75rem;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-save {
            background: var(--success-green);
            color: white;
        }

        .btn-save:hover {
            background: #229954;
            transform: translateY(-1px);
        }

        .btn-reset {
            background: var(--warning-orange);
            color: white;
        }

        .btn-reset:hover {
            background: #e67e22;
            transform: translateY(-1px);
        }

        .btn-delete {
            background: var(--danger-red);
            color: white;
        }

        .btn-delete:hover {
            background: #c0392b;
            transform: translateY(-1px);
        }

        /* ===== FORMULARIO DE CONFIGURACI√ìN ===== */
        .config-form {
            padding: 2rem;
        }

        .form-section {
            margin-bottom: 2.5rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border-light);
        }

        .form-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .section-title {
            color: var(--background-dark);
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section-icon {
            background: var(--primary-blue);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        /* ===== CAMPOS DE FORMULARIO ===== */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--background-dark);
            font-size: 0.95rem;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius);
            font-size: 0.95rem;
            transition: var(--transition);
            background: white;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-help {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }

        /* ===== CAMPOS ESPECIALES ===== */
        .toggle-group {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 25px;
            background: var(--border-light);
            border-radius: 25px;
            cursor: pointer;
            transition: var(--transition);
        }

        .toggle-switch.active {
            background: var(--success-green);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 21px;
            height: 21px;
            background: white;
            border-radius: 50%;
            transition: var(--transition);
        }

        .toggle-switch.active::after {
            transform: translateX(25px);
        }

        /* ===== PANEL DE EQUIPOS ===== */
        .equipment-panel {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-top: 1rem;
        }

        .equipment-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .equipment-card {
            background: white;
            padding: 1rem;
            border-radius: var(--border-radius);
            border: 2px solid transparent;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .equipment-card:hover {
            border-color: var(--primary-blue);
            box-shadow: var(--shadow);
        }

        .equipment-card.selected {
            border-color: var(--success-green);
            background: #d4edda;
        }

        .equipment-name {
            font-weight: bold;
            color: var(--background-dark);
            margin-bottom: 0.5rem;
        }

        .equipment-type {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        /* ===== CONFIGURACI√ìN ESTAD√çSTICA ===== */
        .statistical-config {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-top: 1rem;
        }

        .stat-parameter {
            background: white;
            padding: 1.2rem;
            border-radius: var(--border-radius);
            text-align: center;
            border: 2px solid var(--border-light);
            transition: var(--transition);
        }

        .stat-parameter:hover {
            border-color: var(--primary-blue);
            box-shadow: var(--shadow);
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-blue);
            display: block;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        /* ===== ALERTAS Y NOTIFICACIONES ===== */
        .alert {
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
            border-left: 4px solid;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .alert-success {
            background: #d4edda;
            border-color: var(--success-green);
            color: #155724;
        }

        .alert-warning {
            background: #fff3cd;
            border-color: var(--warning-orange);
            color: #856404;
        }

        .alert-error {
            background: #f8d7da;
            border-color: var(--danger-red);
            color: #721c24;
        }

        .alert-info {
            background: #d1ecf1;
            border-color: var(--primary-blue);
            color: #0c5460;
        }

        /* ===== ESTADO VAC√çO ===== */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            margin-bottom: 0.5rem;
            color: var(--background-dark);
        }

        /* ===== LOADING STATES ===== */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            gap: 1rem;
        }

        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid var(--border-light);
            border-top: 3px solid var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            
            .processes-sidebar {
                position: static;
                max-height: none;
                margin-bottom: 2rem;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 1.5rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .config-form {
                padding: 1.5rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .config-actions {
                flex-direction: column;
                gap: 0.5rem;
            }
        }

        /* ===== ANIMACIONES ===== */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header fade-in">
            <h1>
                ‚öôÔ∏è Configuraci√≥n de Procesos VSM
            </h1>
            <p>Configura procesos individuales, par√°metros estad√≠sticos y tolerancias para detecci√≥n de outliers</p>
            
            <div class="breadcrumb">
                <a href="index.html">üè† Inicio</a>
                <span>‚Ä∫</span>
                <span>Configuraci√≥n de Procesos</span>
            </div>
        </div>

        <!-- Layout Principal -->
        <div class="main-layout">
            <!-- Sidebar - Lista de Procesos -->
            <div class="processes-sidebar slide-in">
                <div class="sidebar-header">
                    <h3>üìã Procesos</h3>
                    <button class="add-process-btn" onclick="createNewProcess()">
                        ‚ûï Nuevo
                    </button>
                </div>
                
                <ul class="process-list" id="processList">
                    <!-- Los procesos se cargar√°n din√°micamente -->
                    <li class="process-item active" data-process-id="1">
                        <div class="process-item-content">
                            <div class="process-name">Soldadura por Puntos</div>
                            <div class="process-meta">
                                <span>L√≠nea A</span>
                                <span>ID: P001</span>
                            </div>
                            <span class="process-status status-configured">Configurado</span>
                        </div>
                    </li>
                    
                    <li class="process-item" data-process-id="2">
                        <div class="process-item-content">
                            <div class="process-name">Ensamble Principal</div>
                            <div class="process-meta">
                                <span>L√≠nea A</span>
                                <span>ID: P002</span>
                            </div>
                            <span class="process-status status-draft">Borrador</span>
                        </div>
                    </li>
                    
                    <li class="process-item" data-process-id="3">
                        <div class="process-item-content">
                            <div class="process-name">Control de Calidad</div>
                            <div class="process-meta">
                                <span>L√≠nea B</span>
                                <span>ID: P003</span>
                            </div>
                            <span class="process-status status-error">Error</span>
                        </div>
                    </li>
                </ul>
            </div>

            <!-- √Årea de Configuraci√≥n Principal -->
            <div class="configuration-area fade-in">
                <div class="config-header">
                    <div class="config-title" id="configTitle">
                        üîß Soldadura por Puntos (P001)
                    </div>
                    <div class="config-actions">
                        <button class="btn btn-save" onclick="saveProcessConfig()">
                            üíæ Guardar
                        </button>
                        <button class="btn btn-reset" onclick="resetForm()">
                            üîÑ Restablecer
                        </button>
                        <button class="btn btn-delete" onclick="deleteProcess()">
                            üóëÔ∏è Eliminar
                        </button>
                    </div>
                </div>

                <div class="config-form" id="configForm">
                    <!-- Alertas -->
                    <div class="alert alert-info" id="saveAlert" style="display: none;">
                        ‚ÑπÔ∏è Los cambios se guardar√°n autom√°ticamente al configurar cada par√°metro.
                    </div>

                    <!-- Informaci√≥n B√°sica -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <span class="section-icon">üìù</span>
                            Informaci√≥n B√°sica
                        </h3>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label" for="processName">Nombre del Proceso</label>
                                <input type="text" id="processName" class="form-input" 
                                       value="Soldadura por Puntos" placeholder="Ej: Soldadura por Puntos">
                                <div class="form-help">Nombre descriptivo del proceso en la l√≠nea de producci√≥n</div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="processId">ID del Proceso</label>
                                <input type="text" id="processId" class="form-input" 
                                       value="P001" placeholder="Ej: P001">
                                <div class="form-help">Identificador √∫nico del proceso (no modificable)</div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="productionLine">L√≠nea de Producci√≥n</label>
                                <select id="productionLine" class="form-select">
                                    <option value="line-a" selected>L√≠nea A - Ensamble Principal</option>
                                    <option value="line-b">L√≠nea B - Componentes</option>
                                    <option value="line-c">L√≠nea C - Acabados</option>
                                </select>
                                <div class="form-help">L√≠nea de producci√≥n a la que pertenece este proceso</div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="processOrder">Orden en Secuencia</label>
                                <input type="number" id="processOrder" class="form-input" 
                                       value="1" min="1" placeholder="1">
                                <div class="form-help">Posici√≥n del proceso en la secuencia de la l√≠nea</div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="processDescription">Descripci√≥n</label>
                            <textarea id="processDescription" class="form-textarea" 
                                      placeholder="Descripci√≥n detallada del proceso...">Proceso de soldadura por puntos para uni√≥n de componentes met√°licos. Utiliza electrodos de resistencia para crear uniones permanentes.</textarea>
                            <div class="form-help">Descripci√≥n detallada del proceso y sus caracter√≠sticas</div>
                        </div>
                    </div>

                    <!-- Configuraci√≥n de Equipos -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <span class="section-icon">üîß</span>
                            Equipos Asignados
                        </h3>
                        
                        <div class="toggle-group">
                            <span>Permitir Equipos Paralelos:</span>
                            <div class="toggle-switch active" onclick="toggleParallelEquipment(this)"></div>
                            <span id="parallelStatus">Habilitado</span>
                        </div>
                        
                        <div class="equipment-panel">
                            <p><strong>Selecciona los equipos que participan en este proceso:</strong></p>
                            <div class="equipment-list" id="equipmentList">
                                <div class="equipment-card selected" data-equipment-id="EQ001">
                                    <div class="equipment-name">Soldadora SP-300</div>
                                    <div class="equipment-type">Soldadura por Puntos</div>
                                </div>
                                
                                <div class="equipment-card" data-equipment-id="EQ002">
                                    <div class="equipment-name">Soldadora SP-301</div>
                                    <div class="equipment-type">Soldadura por Puntos</div>
                                </div>
                                
                                <div class="equipment-card" data-equipment-id="EQ003">
                                    <div class="equipment-name">Control Neum√°tico</div>
                                    <div class="equipment-type">Sistema de Control</div>
                                </div>
                                
                                <div class="equipment-card" data-equipment-id="EQ004">
                                    <div class="equipment-name">Sensor Posici√≥n</div>
                                    <div class="equipment-type">Sensores</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Par√°metros de Tiempo de Ciclo -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <span class="section-icon">‚è±Ô∏è</span>
                            Tiempos de Ciclo
                        </h3>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label" for="targetCycleTime">Tiempo de Ciclo Objetivo (seg)</label>
                                <input type="number" id="targetCycleTime" class="form-input" 
                                       value="45.0" step="0.1" min="0" placeholder="45.0">
                                <div class="form-help">Tiempo de ciclo objetivo definido por ingenier√≠a</div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="minCycleTime">Tiempo M√≠nimo Esperado (seg)</label>
                                <input type="number" id="minCycleTime" class="form-input" 
                                       value="38.0" step="0.1" min="0" placeholder="38.0">
                                <div class="form-help">Tiempo m√≠nimo f√≠sicamente posible para el proceso</div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="maxCycleTime">Tiempo M√°ximo Permitido (seg)</label>
                                <input type="number" id="maxCycleTime" class="form-input" 
                                       value="60.0" step="0.1" min="0" placeholder="60.0">
                                <div class="form-help">Tiempo m√°ximo antes de considerar una anomal√≠a</div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="setupTime">Tiempo de Setup (min)</label>
                                <input type="number" id="setupTime" class="form-input" 
                                       value="15.0" step="0.5" min="0" placeholder="15.0">
                                <div class="form-help">Tiempo necesario para configurar el proceso</div>
                            </div>
                        </div>
                    </div>

                    <!-- Configuraci√≥n Estad√≠stica -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <span class="section-icon">üìä</span>
                            An√°lisis Estad√≠stico
                        </h3>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label" for="stdMultiplier">Multiplicador Desviaci√≥n Est√°ndar (œÉ)</label>
                                <input type="number" id="stdMultiplier" class="form-input" 
                                       value="2.0" step="0.1" min="1" max="3" placeholder="2.0">
                                <div class="form-help">Factor para detecci√≥n de outliers (¬±NœÉ). Recomendado: 2.0</div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="sampleSize">Tama√±o de Muestra para C√°lculos</label>
                                <input type="number" id="sampleSize" class="form-input" 
                                       value="30" min="10" max="100" placeholder="30">
                                <div class="form-help">N√∫mero de datos para c√°lculo de promedios y estad√≠sticas</div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="calculationInterval">Intervalo de C√°lculo (min)</label>
                                <input type="number" id="calculationInterval" class="form-input" 
                                       value="60" min="15" max="480" placeholder="60">
                                <div class="form-help">Frecuencia de actualizaci√≥n de m√©tricas estad√≠sticas</div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="alertThreshold">Umbral de Alerta (%)</label>
                                <input type="number" id="alertThreshold" class="form-input" 
                                       value="10" min="5" max="50" placeholder="10">
                                <div class="form-help">Porcentaje de outliers que activa una alerta</div>
                            </div>
                        </div>
                        
                        <!-- M√©tricas Calculadas en Tiempo Real -->
                        <div class="statistical-config">
                            <div class="stat-parameter">
                                <span class="stat-value" id="currentAverage">45.2</span>
                                <div class="stat-label">Promedio Actual (seg)</div>
                            </div>
                            
                            <div class="stat-parameter">
                                <span class="stat-value" id="currentStdDev">3.1</span>
                                <div class="stat-label">Desviaci√≥n Est√°ndar</div>
                            </div>
                            
                            <div class="stat-parameter">
                                <span class="stat-value" id="outlierPercentage">7.2%</span>
                                <div class="stat-label">Outliers Detectados</div>
                            </div>
                            
                            <div class="stat-parameter">
                                <span class="stat-value" id="efficiency">92.4%</span>
                                <div class="stat-label">Eficiencia del Proceso</div>
                            </div>
                        </div>
                    </div>

                    <!-- Configuraci√≥n de Alertas -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <span class="section-icon">üö®</span>
                            Sistema de Alertas
                        </h3>
                        
                        <div class="toggle-group">
                            <span>Alertas Autom√°ticas:</span>
                            <div class="toggle-switch active" onclick="toggleAlerts(this)"></div>
                            <span id="alertsStatus">Habilitadas</span>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label" for="alertEmail">Email para Alertas</label>
                                <input type="email" id="alertEmail" class="form-input" 
                                       value="supervisor@empresa.com" placeholder="supervisor@empresa.com">
                                <div class="form-help">Direcci√≥n de email para recibir notificaciones</div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="alertFrequency">Frecuencia de Alertas</label>
                                <select id="alertFrequency" class="form-select">
                                    <option value="immediate">Inmediata</option>
                                    <option value="hourly" selected>Cada Hora</option>
                                    <option value="daily">Diaria</option>
                                    <option value="weekly">Semanal</option>
                                </select>
                                <div class="form-help">Con qu√© frecuencia enviar alertas por outliers</div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="escalationLevel">Nivel de Escalamiento</label>
                                <select id="escalationLevel" class="form-select">
                                    <option value="info">Informativo</option>
                                    <option value="warning" selected>Advertencia</option>
                                    <option value="critical">Cr√≠tico</option>
                                    <option value="emergency">Emergencia</option>
                                </select>
                                <div class="form-help">Nivel de prioridad para las alertas generadas</div>
                            </div>
                        </div>
                    </div>

                    <!-- Configuraci√≥n Avanzada -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <span class="section-icon">‚öôÔ∏è</span>
                            Configuraci√≥n Avanzada
                        </h3>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label" for="dataRetention">Retenci√≥n de Datos (d√≠as)</label>
                                <input type="number" id="dataRetention" class="form-input" 
                                       value="90" min="7" max="365" placeholder="90">
                                <div class="form-help">D√≠as que se conservar√°n los datos hist√≥ricos</div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="qualityGate">Quality Gate</label>
                                <select id="qualityGate" class="form-select">
                                    <option value="none">Ninguno</option>
                                    <option value="basic" selected>B√°sico</option>
                                    <option value="advanced">Avanzado</option>
                                    <option value="strict">Estricto</option>
                                </select>
                                <div class="form-help">Nivel de validaci√≥n de calidad aplicado</div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="integrationMode">Modo de Integraci√≥n</label>
                                <select id="integrationMode" class="form-select">
                                    <option value="csv" selected>CSV Files</option>
                                    <option value="api">API REST</option>
                                    <option value="websocket">WebSocket</option>
                                    <option value="database">Base de Datos</option>
                                </select>
                                <div class="form-help">M√©todo de obtenci√≥n de datos del proceso</div>
                            </div>
                        </div>
                        
                        <div class="toggle-group">
                            <span>Modo Mantenimiento:</span>
                            <div class="toggle-switch" onclick="toggleMaintenance(this)"></div>
                            <span id="maintenanceStatus">Inactivo</span>
                        </div>
                        
                        <div class="toggle-group">
                            <span>Logging Detallado:</span>
                            <div class="toggle-switch active" onclick="toggleDetailedLogging(this)"></div>
                            <span id="loggingStatus">Habilitado</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // ===== GESTI√ìN DE ESTADO GLOBAL =====
        let currentProcessId = 1;
        let processes = [
            {
                id: 1,
                name: 'Soldadura por Puntos',
                processId: 'P001',
                line: 'line-a',
                status: 'configured',
                order: 1,
                description: 'Proceso de soldadura por puntos para uni√≥n de componentes met√°licos.',
                equipment: ['EQ001'],
                targetCycleTime: 45.0,
                minCycleTime: 38.0,
                maxCycleTime: 60.0,
                setupTime: 15.0,
                stdMultiplier: 2.0,
                sampleSize: 30,
                calculationInterval: 60,
                alertThreshold: 10,
                alertsEnabled: true,
                alertEmail: 'supervisor@empresa.com',
                alertFrequency: 'hourly',
                escalationLevel: 'warning',
                dataRetention: 90,
                qualityGate: 'basic',
                integrationMode: 'csv',
                maintenanceMode: false,
                detailedLogging: true,
                parallelEquipment: true
            },
            {
                id: 2,
                name: 'Ensamble Principal',
                processId: 'P002',
                line: 'line-a',
                status: 'draft',
                order: 2,
                description: 'Ensamble de componentes principales del producto.',
                equipment: [],
                targetCycleTime: 60.0,
                minCycleTime: 50.0,
                maxCycleTime: 80.0,
                setupTime: 20.0,
                stdMultiplier: 2.0,
                sampleSize: 30,
                calculationInterval: 60,
                alertThreshold: 15,
                alertsEnabled: false,
                alertEmail: '',
                alertFrequency: 'hourly',
                escalationLevel: 'info',
                dataRetention: 90,
                qualityGate: 'none',
                integrationMode: 'csv',
                maintenanceMode: false,
                detailedLogging: false,
                parallelEquipment: false
            },
            {
                id: 3,
                name: 'Control de Calidad',
                processId: 'P003',
                line: 'line-b',
                status: 'error',
                order: 1,
                description: 'Proceso de control de calidad y validaci√≥n.',
                equipment: ['EQ003'],
                targetCycleTime: 30.0,
                minCycleTime: 25.0,
                maxCycleTime: 45.0,
                setupTime: 10.0,
                stdMultiplier: 2.5,
                sampleSize: 25,
                calculationInterval: 30,
                alertThreshold: 5,
                alertsEnabled: true,
                alertEmail: 'calidad@empresa.com',
                alertFrequency: 'immediate',
                escalationLevel: 'critical',
                dataRetention: 180,
                qualityGate: 'strict',
                integrationMode: 'api',
                maintenanceMode: true,
                detailedLogging: true,
                parallelEquipment: false
            }
        ];

        let availableEquipment = [
            { id: 'EQ001', name: 'Soldadora SP-300', type: 'Soldadura por Puntos' },
            { id: 'EQ002', name: 'Soldadora SP-301', type: 'Soldadura por Puntos' },
            { id: 'EQ003', name: 'Control Neum√°tico', type: 'Sistema de Control' },
            { id: 'EQ004', name: 'Sensor Posici√≥n', type: 'Sensores' },
            { id: 'EQ005', name: 'Robot Ensamble', type: 'Automatizaci√≥n' },
            { id: 'EQ006', name: 'C√°mara Visi√≥n', type: 'Control de Calidad' }
        ];

        // ===== INICIALIZACI√ìN =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üè≠ Sistema de Configuraci√≥n de Procesos VSM iniciado');
            
            initializeProcessList();
            loadProcessConfiguration(currentProcessId);
            setupEventListeners();
            simulateRealtimeMetrics();
            
            showAlert('Sistema cargado correctamente', 'success');
        });

        // ===== GESTI√ìN DE LISTA DE PROCESOS =====
        function initializeProcessList() {
            const processList = document.getElementById('processList');
            processList.innerHTML = '';
            
            processes.forEach(process => {
                const processItem = createProcessListItem(process);
                processList.appendChild(processItem);
            });
        }

        function createProcessListItem(process) {
            const li = document.createElement('li');
            li.className = `process-item ${process.id === currentProcessId ? 'active' : ''}`;
            li.setAttribute('data-process-id', process.id);
            
            const statusClass = `status-${process.status}`;
            const statusText = {
                'configured': 'Configurado',
                'draft': 'Borrador',
                'error': 'Error'
            }[process.status] || 'Desconocido';
            
            li.innerHTML = `
                <div class="process-item-content">
                    <div class="process-name">${process.name}</div>
                    <div class="process-meta">
                        <span>${getLineName(process.line)}</span>
                        <span>ID: ${process.processId}</span>
                    </div>
                    <span class="process-status ${statusClass}">${statusText}</span>
                </div>
            `;
            
            li.addEventListener('click', () => selectProcess(process.id));
            
            return li;
        }

        function getLineName(lineId) {
            const lineNames = {
                'line-a': 'L√≠nea A',
                'line-b': 'L√≠nea B',
                'line-c': 'L√≠nea C'
            };
            return lineNames[lineId] || 'L√≠nea Desconocida';
        }

        function selectProcess(processId) {
            // Actualizar estado visual
            document.querySelectorAll('.process-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.querySelector(`[data-process-id="${processId}"]`).classList.add('active');
            
            // Cargar configuraci√≥n
            currentProcessId = processId;
            loadProcessConfiguration(processId);
        }

        // ===== CARGA DE CONFIGURACI√ìN =====
        function loadProcessConfiguration(processId) {
            const process = processes.find(p => p.id === processId);
            if (!process) {
                showAlert('Proceso no encontrado', 'error');
                return;
            }
            
            // Actualizar t√≠tulo
            document.getElementById('configTitle').textContent = 
                `üîß ${process.name} (${process.processId})`;
            
            // Cargar datos b√°sicos
            document.getElementById('processName').value = process.name;
            document.getElementById('processId').value = process.processId;
            document.getElementById('productionLine').value = process.line;
            document.getElementById('processOrder').value = process.order;
            document.getElementById('processDescription').value = process.description;
            
            // Cargar tiempos de ciclo
            document.getElementById('targetCycleTime').value = process.targetCycleTime;
            document.getElementById('minCycleTime').value = process.minCycleTime;
            document.getElementById('maxCycleTime').value = process.maxCycleTime;
            document.getElementById('setupTime').value = process.setupTime;
            
            // Cargar configuraci√≥n estad√≠stica
            document.getElementById('stdMultiplier').value = process.stdMultiplier;
            document.getElementById('sampleSize').value = process.sampleSize;
            document.getElementById('calculationInterval').value = process.calculationInterval;
            document.getElementById('alertThreshold').value = process.alertThreshold;
            
            // Cargar configuraci√≥n de alertas
            updateToggleState('alertsStatus', process.alertsEnabled);
            document.getElementById('alertEmail').value = process.alertEmail;
            document.getElementById('alertFrequency').value = process.alertFrequency;
            document.getElementById('escalationLevel').value = process.escalationLevel;
            
            // Cargar configuraci√≥n avanzada
            document.getElementById('dataRetention').value = process.dataRetention;
            document.getElementById('qualityGate').value = process.qualityGate;
            document.getElementById('integrationMode').value = process.integrationMode;
            updateToggleState('maintenanceStatus', process.maintenanceMode);
            updateToggleState('loggingStatus', process.detailedLogging);
            updateToggleState('parallelStatus', process.parallelEquipment);
            
            // Cargar equipos
            loadEquipmentSelection(process.equipment);
            
            // Aplicar animaci√≥n
            document.getElementById('configForm').classList.add('fade-in');
            
            console.log(`üìù Configuraci√≥n cargada para proceso: ${process.name}`);
        }

        // ===== GESTI√ìN DE EQUIPOS =====
        function loadEquipmentSelection(selectedEquipment) {
            const equipmentList = document.getElementById('equipmentList');
            equipmentList.innerHTML = '';
            
            availableEquipment.forEach(equipment => {
                const equipmentCard = document.createElement('div');
                equipmentCard.className = `equipment-card ${selectedEquipment.includes(equipment.id) ? 'selected' : ''}`;
                equipmentCard.setAttribute('data-equipment-id', equipment.id);
                
                equipmentCard.innerHTML = `
                    <div class="equipment-name">${equipment.name}</div>
                    <div class="equipment-type">${equipment.type}</div>
                `;
                
                equipmentCard.addEventListener('click', () => toggleEquipmentSelection(equipment.id));
                equipmentList.appendChild(equipmentCard);
            });
        }

        function toggleEquipmentSelection(equipmentId) {
            const card = document.querySelector(`[data-equipment-id="${equipmentId}"]`);
            const process = processes.find(p => p.id === currentProcessId);
            
            if (card.classList.contains('selected')) {
                card.classList.remove('selected');
                process.equipment = process.equipment.filter(id => id !== equipmentId);
            } else {
                card.classList.add('selected');
                process.equipment.push(equipmentId);
            }
            
            console.log(`üîß Equipo ${equipmentId} ${card.classList.contains('selected') ? 'seleccionado' : 'deseleccionado'}`);
        }

        // ===== GESTI√ìN DE TOGGLES =====
        function toggleParallelEquipment(toggle) {
            const isActive = toggle.classList.toggle('active');
            const process = processes.find(p => p.id === currentProcessId);
            process.parallelEquipment = isActive;
            
            updateToggleState('parallelStatus', isActive);
        }

        function toggleAlerts(toggle) {
            const isActive = toggle.classList.toggle('active');
            const process = processes.find(p => p.id === currentProcessId);
            process.alertsEnabled = isActive;
            
            updateToggleState('alertsStatus', isActive);
        }

        function toggleMaintenance(toggle) {
            const isActive = toggle.classList.toggle('active');
            const process = processes.find(p => p.id === currentProcessId);
            process.maintenanceMode = isActive;
            
            updateToggleState('maintenanceStatus', isActive);
        }

        function toggleDetailedLogging(toggle) {
            const isActive = toggle.classList.toggle('active');
            const process = processes.find(p => p.id === currentProcessId);
            process.detailedLogging = isActive;
            
            updateToggleState('loggingStatus', isActive);
        }

        function updateToggleState(statusElementId, isActive) {
            const statusElement = document.getElementById(statusElementId);
            const statusTexts = {
                'parallelStatus': isActive ? 'Habilitado' : 'Deshabilitado',
                'alertsStatus': isActive ? 'Habilitadas' : 'Deshabilitadas',
                'maintenanceStatus': isActive ? 'Activo' : 'Inactivo',
                'loggingStatus': isActive ? 'Habilitado' : 'Deshabilitado'
            };
            
            statusElement.textContent = statusTexts[statusElementId];
        }

        // ===== ACCIONES PRINCIPALES =====
        function saveProcessConfig() {
            const process = processes.find(p => p.id === currentProcessId);
            if (!process) return;
            
            // Recopilar datos del formulario
            process.name = document.getElementById('processName').value;
            process.processId = document.getElementById('processId').value;
            process.line = document.getElementById('productionLine').value;
            process.order = parseInt(document.getElementById('processOrder').value);
            process.description = document.getElementById('processDescription').value;
            
            process.targetCycleTime = parseFloat(document.getElementById('targetCycleTime').value);
            process.minCycleTime = parseFloat(document.getElementById('minCycleTime').value);
            process.maxCycleTime = parseFloat(document.getElementById('maxCycleTime').value);
            process.setupTime = parseFloat(document.getElementById('setupTime').value);
            
            process.stdMultiplier = parseFloat(document.getElementById('stdMultiplier').value);
            process.sampleSize = parseInt(document.getElementById('sampleSize').value);
            process.calculationInterval = parseInt(document.getElementById('calculationInterval').value);
            process.alertThreshold = parseInt(document.getElementById('alertThreshold').value);
            
            process.alertEmail = document.getElementById('alertEmail').value;
            process.alertFrequency = document.getElementById('alertFrequency').value;
            process.escalationLevel = document.getElementById('escalationLevel').value;
            
            process.dataRetention = parseInt(document.getElementById('dataRetention').value);
            process.qualityGate = document.getElementById('qualityGate').value;
            process.integrationMode = document.getElementById('integrationMode').value;
            
            // Actualizar estado
            process.status = 'configured';
            
            // Actualizar lista visual
            initializeProcessList();
            
            // Simular guardado
            showAlert('Configuraci√≥n guardada exitosamente', 'success');
            console.log(`üíæ Proceso ${process.name} guardado:`, process);
            
            // Simular llamada a API
            setTimeout(() => {
                fetch('/api/admin/processes/' + process.id, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(process)
                }).catch(err => console.log('API no disponible en demo'));
            }, 100);
        }

        function resetForm() {
            if (confirm('¬øEst√°s seguro de que quieres restablecer la configuraci√≥n?')) {
                loadProcessConfiguration(currentProcessId);
                showAlert('Configuraci√≥n restablecida', 'info');
            }
        }

        function deleteProcess() {
            const process = processes.find(p => p.id === currentProcessId);
            if (!process) return;
            
            if (confirm(`¬øEst√°s seguro de que quieres eliminar el proceso "${process.name}"?`)) {
                processes = processes.filter(p => p.id !== currentProcessId);
                
                if (processes.length > 0) {
                    currentProcessId = processes[0].id;
                    initializeProcessList();
                    loadProcessConfiguration(currentProcessId);
                } else {
                    document.getElementById('configForm').innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üìù</div>
                            <h3>No hay procesos configurados</h3>
                            <p>Crea un nuevo proceso para comenzar</p>
                        </div>
                    `;
                }
                
                showAlert('Proceso eliminado exitosamente', 'success');
            }
        }

        function createNewProcess() {
            const newId = Math.max(...processes.map(p => p.id)) + 1;
            const newProcess = {
                id: newId,
                name: 'Nuevo Proceso',
                processId: `P${String(newId).padStart(3, '0')}`,
                line: 'line-a',
                status: 'draft',
                order: 1,
                description: '',
                equipment: [],
                targetCycleTime: 60.0,
                minCycleTime: 50.0,
                maxCycleTime: 80.0,
                setupTime: 15.0,
                stdMultiplier: 2.0,
                sampleSize: 30,
                calculationInterval: 60,
                alertThreshold: 10,
                alertsEnabled: false,
                alertEmail: '',
                alertFrequency: 'hourly',
                escalationLevel: 'info',
                dataRetention: 90,
                qualityGate: 'basic',
                integrationMode: 'csv',
                maintenanceMode: false,
                detailedLogging: true,
                parallelEquipment: false
            };
            
            processes.push(newProcess);
            currentProcessId = newId;
            
            initializeProcessList();
            loadProcessConfiguration(newId);
            
            showAlert('Nuevo proceso creado', 'success');
            
            // Enfocar en el nombre para edici√≥n inmediata
            setTimeout(() => {
                document.getElementById('processName').focus();
                document.getElementById('processName').select();
            }, 100);
        }

        // ===== M√âTRICAS EN TIEMPO REAL =====
        function simulateRealtimeMetrics() {
            setInterval(() => {
                const process = processes.find(p => p.id === currentProcessId);
                if (!process || process.maintenanceMode) return;
                
                // Simular valores en tiempo real
                const baseTime = process.targetCycleTime;
                const variation = baseTime * 0.1;
                
                const currentAverage = baseTime + (Math.random() - 0.5) * variation;
                const currentStdDev = Math.random() * 5 + 1;
                const outlierPercentage = Math.random() * 15;
                const efficiency = Math.max(80, 100 - outlierPercentage);
                
                // Actualizar display
                document.getElementById('currentAverage').textContent = currentAverage.toFixed(1);
                document.getElementById('currentStdDev').textContent = currentStdDev.toFixed(1);
                document.getElementById('outlierPercentage').textContent = outlierPercentage.toFixed(1) + '%';
                document.getElementById('efficiency').textContent = efficiency.toFixed(1) + '%';
                
                // Cambiar colores seg√∫n thresholds
                updateMetricColors(outlierPercentage, process.alertThreshold);
                
            }, 5000); // Actualizar cada 5 segundos
        }

        function updateMetricColors(outlierPercentage, threshold) {
            const outlierElement = document.getElementById('outlierPercentage');
            const efficiencyElement = document.getElementById('efficiency');
            
            if (outlierPercentage > threshold) {
                outlierElement.style.color = 'var(--danger-red)';
                efficiencyElement.style.color = 'var(--warning-orange)';
            } else {
                outlierElement.style.color = 'var(--primary-blue)';
                efficiencyElement.style.color = 'var(--success-green)';
            }
        }

        // ===== SISTEMA DE ALERTAS =====
        function showAlert(message, type = 'info') {
            const alertClass = `alert-${type}`;
            const icons = {
                'success': '‚úÖ',
                'warning': '‚ö†Ô∏è',
                'error': '‚ùå',
                'info': '‚ÑπÔ∏è'
            };
            
            const alertElement = document.createElement('div');
            alertElement.className = `alert ${alertClass}`;
            alertElement.innerHTML = `${icons[type]} ${message}`;
            
            // Insertar al inicio del formulario
            const configForm = document.getElementById('configForm');
            configForm.insertBefore(alertElement, configForm.firstChild);
            
            // Auto-remove despu√©s de 5 segundos
            setTimeout(() => {
                alertElement.remove();
            }, 5000);
        }

        // ===== EVENT LISTENERS =====
        function setupEventListeners() {
            // Auto-save en cambios de campos cr√≠ticos
            const autoSaveFields = [
                'targetCycleTime', 'minCycleTime', 'maxCycleTime',
                'stdMultiplier', 'alertThreshold'
            ];
            
            autoSaveFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('change', () => {
                        console.log(`üîÑ Auto-guardando cambio en ${fieldId}`);
                        // En producci√≥n aqu√≠ ir√≠a una llamada para guardar espec√≠ficamente este campo
                    });
                }
            });
            
            // Validaciones en tiempo real
            document.getElementById('processName').addEventListener('input', function() {
                if (this.value.length < 3) {
                    this.style.borderColor = 'var(--danger-red)';
                } else {
                    this.style.borderColor = 'var(--border-light)';
                }
            });
            
            // Validar rangos de tiempo de ciclo
            const timeFields = ['minCycleTime', 'targetCycleTime', 'maxCycleTime'];
            timeFields.forEach(fieldId => {
                document.getElementById(fieldId).addEventListener('change', validateTimeRanges);
            });
        }

        function validateTimeRanges() {
            const minTime = parseFloat(document.getElementById('minCycleTime').value);
            const targetTime = parseFloat(document.getElementById('targetCycleTime').value);
            const maxTime = parseFloat(document.getElementById('maxCycleTime').value);
            
            let isValid = true;
            
            if (minTime >= targetTime) {
                document.getElementById('minCycleTime').style.borderColor = 'var(--danger-red)';
                isValid = false;
            } else {
                document.getElementById('minCycleTime').style.borderColor = 'var(--border-light)';
            }
            
            if (targetTime >= maxTime) {
                document.getElementById('maxCycleTime').style.borderColor = 'var(--danger-red)';
                isValid = false;
            } else {
                document.getElementById('maxCycleTime').style.borderColor = 'var(--border-light)';
            }
            
            if (!isValid) {
                showAlert('Los tiempos deben cumplir: M√≠nimo < Objetivo < M√°ximo', 'warning');
            }
        }

        // ===== UTILIDADES =====
        function formatTime(seconds) {
            if (seconds < 60) {
                return `${seconds}s`;
            } else {
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                return `${minutes}m ${remainingSeconds}s`;
            }
        }

        function validateConfiguration() {
            const process = processes.find(p => p.id === currentProcessId);
            if (!process) return false;
            
            const validations = [
                { condition: process.name.length >= 3, message: 'Nombre del proceso debe tener al menos 3 caracteres' },
                { condition: process.equipment.length > 0, message: 'Debe seleccionar al menos un equipo' },
                { condition: process.minCycleTime < process.targetCycleTime, message: 'Tiempo m√≠nimo debe ser menor al objetivo' },
                { condition: process.targetCycleTime < process.maxCycleTime, message: 'Tiempo objetivo debe ser menor al m√°ximo' },
                { condition: process.stdMultiplier >= 1 && process.stdMultiplier <= 3, message: 'Multiplicador œÉ debe estar entre 1 y 3' },
                { condition: process.sampleSize >= 10, message: 'Tama√±o de muestra debe ser al menos 10' },
                { condition: process.alertThreshold >= 1 && process.alertThreshold <= 50, message: 'Umbral de alerta debe estar entre 1% y 50%' }
            ];
            
            for (const validation of validations) {
                if (!validation.condition) {
                    showAlert(validation.message, 'error');
                    return false;
                }
            }
            
            return true;
        }

        // ===== EXPORTACI√ìN/IMPORTACI√ìN =====
        function exportConfiguration() {
            const process = processes.find(p => p.id === currentProcessId);
            if (!process) return;
            
            const configData = {
                exportDate: new Date().toISOString(),
                version: '1.0',
                process: process
            };
            
            const dataStr = JSON.stringify(configData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `proceso_${process.processId}_${new Date().toISOString().slice(0, 10)}.json`;
            link.click();
            
            showAlert('Configuraci√≥n exportada exitosamente', 'success');
        }

        function importConfiguration() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const configData = JSON.parse(e.target.result);
                        if (configData.process) {
                            // Asignar nuevo ID para evitar conflictos
                            const newId = Math.max(...processes.map(p => p.id)) + 1;
                            configData.process.id = newId;
                            configData.process.processId = `P${String(newId).padStart(3, '0')}`;
                            configData.process.status = 'draft';
                            
                            processes.push(configData.process);
                            currentProcessId = newId;
                            
                            initializeProcessList();
                            loadProcessConfiguration(newId);
                            
                            showAlert('Configuraci√≥n importada exitosamente', 'success');
                        } else {
                            showAlert('Archivo de configuraci√≥n inv√°lido', 'error');
                        }
                    } catch (error) {
                        showAlert('Error al leer el archivo de configuraci√≥n', 'error');
                        console.error('Error parsing config file:', error);
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        // ===== INTEGRACI√ìN CON APIS =====
        async function testIntegration() {
            const process = processes.find(p => p.id === currentProcessId);
            if (!process) return;
            
            showAlert('Probando integraci√≥n...', 'info');
            
            try {
                // Simular test de integraci√≥n seg√∫n el modo configurado
                const testEndpoint = {
                    'csv': '/api/admin/test-csv-connection',
                    'api': '/api/admin/test-api-connection',
                    'websocket': '/api/admin/test-websocket-connection',
                    'database': '/api/admin/test-database-connection'
                }[process.integrationMode];
                
                // Simular llamada (en demo)
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Simular respuesta exitosa
                if (Math.random() > 0.2) { // 80% √©xito
                    showAlert('Integraci√≥n probada exitosamente', 'success');
                } else {
                    showAlert('Error en la prueba de integraci√≥n', 'error');
                }
                
            } catch (error) {
                showAlert('Error al probar la integraci√≥n', 'error');
                console.error('Integration test error:', error);
            }
        }

        // ===== FUNCIONES DE APOYO PARA DEBUGGING =====
        function debugProcessState() {
            console.group('üîç Debug - Estado del Proceso');
            console.log('Proceso actual ID:', currentProcessId);
            console.log('Proceso actual:', processes.find(p => p.id === currentProcessId));
            console.log('Todos los procesos:', processes);
            console.log('Equipos disponibles:', availableEquipment);
            console.groupEnd();
        }

        // Exponer funciones para debugging en consola
        window.vsmDebug = {
            debugProcessState,
            processes,
            currentProcessId,
            exportConfiguration,
            importConfiguration,
            testIntegration
        };

        // ===== ATAJOS DE TECLADO =====
        document.addEventListener('keydown', function(event) {
            // Ctrl+S para guardar
            if (event.ctrlKey && event.key === 's') {
                event.preventDefault();
                saveProcessConfig();
            }
            
            // Ctrl+N para nuevo proceso
            if (event.ctrlKey && event.key === 'n') {
                event.preventDefault();
                createNewProcess();
            }
            
            // Escape para cancelar/reset
            if (event.key === 'Escape') {
                resetForm();
            }
        });

        console.log('‚öôÔ∏è Sistema de Configuraci√≥n de Procesos VSM listo');
        console.log('üí° Tip: Usa Ctrl+S para guardar r√°pido, Ctrl+N para nuevo proceso');
        console.log('üîç Debug: window.vsmDebug contiene utilidades de debugging');
    </script>
</body>
</html>